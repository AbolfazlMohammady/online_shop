{% extends "base.html" %}

{% block contact %}
<style>
.line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
}

/* Modern Product Card Styles */
.product-card {
    position: relative;
    background: linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255,255,255,0.2);
    border-radius: 16px;
    overflow: hidden;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    height: 420px;
    display: flex;
    flex-direction: column;
}

.product-card:hover {
    transform: translateY(-8px);
    box-shadow: 0 20px 40px rgba(147, 51, 234, 0.15);
    border-color: rgba(147, 51, 234, 0.3);
}

.product-image-container {
    position: relative;
    height: 240px;
    overflow: hidden;
    background: linear-gradient(135deg, #f3e8ff 0%, #e9d5ff 100%);
}

.product-image {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.3s ease;
}

.product-card:hover .product-image {
    transform: scale(1.05);
}

.product-overlay {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    background: linear-gradient(transparent, rgba(0,0,0,0.7));
    padding: 20px 16px 16px;
    color: white;
}

.product-title {
    font-size: 14px;
    font-weight: 600;
    margin-bottom: 8px;
    line-height: 1.3;
    text-shadow: 0 1px 2px rgba(0,0,0,0.5);
}

.category-tag {
    display: inline-block;
    background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
    color: white;
    padding: 4px 8px;
    border-radius: 12px;
    font-size: 10px;
    font-weight: 500;
    margin-bottom: 8px;
    box-shadow: 0 2px 4px rgba(139, 92, 246, 0.3);
}

.product-content {
    padding: 16px;
    flex: 1;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
}

.product-info {
    margin-bottom: 12px;
}

.product-rating {
    display: flex;
    align-items: center;
    gap: 6px;
    margin-bottom: 8px;
}

.stars {
    display: flex;
    gap: 1px;
}

.stars i {
    font-size: 10px;
}

.rating-text {
    font-size: 11px;
    color: #6b7280;
}

.product-price {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-bottom: 12px;
}

.current-price {
    font-size: 16px;
    font-weight: 700;
    color: #7c3aed;
}

.original-price {
    font-size: 12px;
    color: #9ca3af;
    text-decoration: line-through;
}

.discount-badge {
    position: absolute;
    top: 12px;
    right: 12px;
    background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
    color: white;
    padding: 4px 8px;
    border-radius: 12px;
    font-size: 10px;
    font-weight: 600;
    box-shadow: 0 2px 8px rgba(239, 68, 68, 0.3);
    z-index: 10;
}

.bestseller-badge {
    position: absolute;
    top: 12px;
    left: 12px;
    background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
    color: white;
    padding: 4px 8px;
    border-radius: 12px;
    font-size: 10px;
    font-weight: 600;
    box-shadow: 0 2px 8px rgba(245, 158, 11, 0.3);
    z-index: 10;
}

.new-badge {
    position: absolute;
    top: 12px;
    left: 12px;
    background: linear-gradient(135deg, #10b981 0%, #059669 100%);
    color: white;
    padding: 4px 8px;
    border-radius: 12px;
    font-size: 10px;
    font-weight: 600;
    box-shadow: 0 2px 8px rgba(16, 185, 129, 0.3);
    z-index: 10;
}

.cart-button {
    position: absolute;
    bottom: 16px;
    right: 16px;
    width: 40px;
    height: 40px;
    background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
    border: none;
    border-radius: 50%;
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 4px 12px rgba(139, 92, 246, 0.3);
    z-index: 10;
}

.cart-button:hover {
    transform: scale(1.1);
    box-shadow: 0 6px 16px rgba(139, 92, 246, 0.4);
}

.cart-button i {
    font-size: 14px;
}

/* Responsive Grid */
.products-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 24px;
    padding: 24px 0;
}

@media (max-width: 768px) {
    .products-grid {
        grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
        gap: 16px;
        padding: 16px 0;
    }
    
    .product-card {
        height: 380px;
    }
    
    .product-image-container {
        height: 200px;
    }
}

@media (max-width: 480px) {
    .products-grid {
        grid-template-columns: 1fr;
        gap: 12px;
    }
    
    .product-card {
        height: 360px;
    }
    
    .product-image-container {
        height: 180px;
    }
}

/* Placeholder styles */
.placeholder-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    height: 100%;
    color: #9ca3af;
    background: linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%);
}

.placeholder-icon {
    font-size: 32px;
    margin-bottom: 8px;
    opacity: 0.5;
}

.placeholder-text {
    font-size: 12px;
    text-align: center;
    opacity: 0.7;
}
</style>
<div class="min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <h2 class="text-3xl font-bold text-center mb-8">محصولات ما</h2>
        
        <!-- Circular Cosmetic Filter Box -->
        <div class="relative mb-8 flex justify-end">
            <!-- Circular Compact Design -->
            <div id="cosmetic-compact" class="relative">
                <!-- Compact Base (Closed State) -->
                <div id="compact-base" class="w-16 h-16 sm:w-20 sm:h-20 rounded-full bg-gradient-to-br from-pink-400 via-purple-500 to-indigo-500 shadow-2xl cursor-pointer transform transition-all duration-500 hover:scale-110 relative overflow-hidden border-4 border-white/30" onclick="toggleCompact()">
                    <!-- Mirror Effect -->
                    <div class="absolute inset-1 rounded-full bg-gradient-to-br from-pink-200/80 to-purple-200/80 shadow-inner border-2 border-white/60">
                        <!-- Reflection -->
                        <div class="absolute top-1.5 left-1.5 sm:top-2 sm:left-2 w-3 h-3 sm:w-4 sm:h-4 bg-white/40 rounded-full blur-sm"></div>
                        <div class="absolute bottom-2 right-2 sm:bottom-3 sm:right-3 w-1.5 h-1.5 sm:w-2 sm:h-2 bg-white/30 rounded-full blur-sm"></div>
                    </div>
                    
                    <!-- Brand Logo -->
                    <div class="absolute inset-0 flex items-center justify-center">
                        <div class="text-center">
                            <i class="fas fa-sliders-h text-lg sm:text-2xl text-white drop-shadow-lg"></i>
                        </div>
                    </div>
                    
                    <!-- Shimmer Effect -->
                    <div class="absolute inset-0 rounded-full bg-gradient-to-r from-transparent via-white/30 to-transparent transform -skew-x-12 animate-shimmer"></div>
                    
                    <!-- Pulse Ring -->
                    <div class="absolute inset-0 rounded-full border-2 border-white/20 animate-ping"></div>
                </div>
                
                <!-- Expanded Filter Panel -->
                <div id="filter-panel" class="fixed top-0 right-0 w-80 h-full bg-gradient-to-br from-pink-50 via-purple-50 to-indigo-50 dark:from-gray-800 dark:via-gray-700 dark:to-gray-600 shadow-2xl transform translate-x-full transition-all duration-700 ease-out z-50 overflow-y-auto" style="border-radius: 50px 0 0 50px;">
                    <!-- Close Button -->
                    <button onclick="toggleCompact()" class="absolute top-6 left-6 w-10 h-10 bg-red-500 hover:bg-red-600 text-white rounded-full flex items-center justify-center transition-colors z-20">
                        <i class="fas fa-times"></i>
                    </button>
                    
                    <!-- Filter Content -->
                    <div class="p-6 pt-20 h-full">
                        <!-- Search -->
                        <div class="mb-4">
                            <div class="relative">
                                <input type="text" id="search-input" placeholder="جستجو..." class="w-full p-3 pr-10 border-2 border-pink-200 dark:border-gray-600 bg-white/80 dark:bg-gray-700 backdrop-blur-sm rounded-full focus:outline-none focus:ring-2 focus:ring-purple-400 focus:border-purple-400 transition-all duration-300 text-sm">
                                <div class="absolute right-3 top-1/2 transform -translate-y-1/2 text-pink-400">
                                    <i class="fas fa-search"></i>
                                </div>
                            </div>
                        </div>
                        

                        
                        <!-- Category Pills -->
                        <div class="mb-4">
                            <h4 class="text-sm font-bold mb-2 text-center">دسته‌بندی</h4>
                            <div class="flex flex-wrap gap-1 justify-center">
                                <button onclick="setCategoryFilter('')" class="category-pill active px-3 py-1 bg-gradient-to-r from-gray-200 to-gray-300 dark:from-gray-600 dark:to-gray-700 text-gray-700 dark:text-gray-200 rounded-full text-xs font-medium transition-all duration-300 hover:scale-105">
                                    همه
                                </button>
                                {% for category in categories %}
                                <button onclick="setCategoryFilter('{{ category.slug }}')" class="category-pill px-3 py-1 bg-gradient-to-r from-red-200 to-pink-200 text-red-700 rounded-full text-xs font-medium transition-all duration-300 hover:scale-105">
                                    {{ category.icon }} {{ category.name }}
                                </button>
                                {% endfor %}
                            </div>
                        </div>
                        

                        
                        <!-- Brand Pills -->
                        <div class="mb-4">
                            <h4 class="text-sm font-bold mb-2 text-center">برند</h4>
                            <div class="flex flex-wrap gap-1 justify-center">
                                <button onclick="setBrandFilter('')" class="brand-pill active px-3 py-1 bg-gradient-to-r from-gray-200 to-gray-300 dark:from-gray-600 dark:to-gray-700 text-gray-700 dark:text-gray-200 rounded-full text-xs font-medium transition-all duration-300 hover:scale-105">
                                    همه
                                </button>
                                {% for brand in brands %}
                                <button onclick="setBrandFilter('{{ brand.slug }}')" class="brand-pill px-3 py-1 bg-gradient-to-r from-blue-200 to-indigo-200 text-blue-700 rounded-full text-xs font-medium transition-all duration-300 hover:scale-105">
                                    {% if brand.logo %}
                                    <img src="{{ brand.logo.url }}" alt="{{ brand.name }}" class="w-4 h-4 inline-block mr-1 rounded-full">
                                    {% else %}
                                    <i class="fas fa-tag mr-1"></i>
                                    {% endif %}
                                    {{ brand.name }}
                                </button>
                                {% endfor %}
                            </div>
                        </div>
                        
                        <!-- Price Range -->
                        <div class="mb-4">
                            <h4 class="text-sm font-bold mb-2 text-center">قیمت</h4>
                            <div class="grid grid-cols-2 gap-2">
                                <input type="text" id="min-price" placeholder="حداقل" class="p-2 border border-pink-200 dark:border-gray-600 bg-white/70 dark:bg-gray-700 rounded-lg focus:outline-none focus:ring-1 focus:ring-pink-400 text-xs" oninput="formatPriceInput(this)">
                                <input type="text" id="max-price" placeholder="حداکثر" class="p-2 border border-pink-200 dark:border-gray-600 bg-white/70 dark:bg-gray-700 rounded-lg focus:outline-none focus:ring-1 focus:ring-pink-400 text-xs" oninput="formatPriceInput(this)">
                            </div>
                        </div>
                        
                        <!-- Sort -->
                        <div class="mb-4">
                            <h4 class="text-sm font-bold mb-2 text-center">مرتب‌سازی</h4>
                            <select id="sort-filter" class="w-full p-2 border border-purple-200 dark:border-gray-600 bg-white/80 dark:bg-gray-700 rounded-lg focus:outline-none focus:ring-1 focus:ring-purple-400 text-xs appearance-none cursor-pointer">
                                <option value="default">پیش‌فرض</option>
                                <option value="price-low">💰 ارزان‌ترین</option>
                                <option value="price-high">💎 گران‌ترین</option>
                                <option value="rating">⭐ بهترین</option>
                                <option value="name">🔤 الفبایی</option>
                            </select>
                        </div>
                        
                        <!-- Quick Filters -->
                        <div class="mb-4">
                            <h4 class="text-sm font-bold mb-2 text-center">فیلتر سریع</h4>
                            <div class="flex flex-wrap gap-1 justify-center">
                                <button onclick="quickFilter('bestseller')" class="quick-filter-btn px-2 py-1 bg-gradient-to-r from-red-100 to-pink-100 text-red-600 rounded-full text-xs font-medium transition-all duration-300 hover:scale-105 border border-red-200">
                                    🔥 پرفروش
                                </button>
                                <button onclick="quickFilter('discount')" class="quick-filter-btn px-2 py-1 bg-gradient-to-r from-orange-100 to-yellow-100 text-orange-600 rounded-full text-xs font-medium transition-all duration-300 hover:scale-105 border border-orange-200">
                                    💸 تخفیف
                                </button>
                                <button onclick="quickFilter('new')" class="quick-filter-btn px-2 py-1 bg-gradient-to-r from-green-100 to-emerald-100 text-green-600 rounded-full text-xs font-medium transition-all duration-300 hover:scale-105 border border-green-200">
                                    ✨ جدید
                                </button>
                                <button onclick="quickFilter('luxury')" class="quick-filter-btn px-2 py-1 bg-gradient-to-r from-purple-100 to-indigo-100 text-purple-600 rounded-full text-xs font-medium transition-all duration-300 hover:scale-105 border border-purple-200">
                                    👑 لوکس
                                </button>
                            </div>
                        </div>
                        
                        <!-- Action Buttons -->
                        <div class="flex gap-2 justify-center">
                            <button id="apply-price-filter" class="px-4 py-2 bg-gradient-to-r from-pink-500 to-purple-500 hover:from-pink-600 hover:to-purple-600 text-white rounded-full font-semibold text-xs transition-all duration-300 transform hover:scale-105 shadow-lg">
                                اعمال
                            </button>
                            <button id="clear-filters-btn" class="px-4 py-2 bg-gradient-to-r from-gray-400 to-gray-500 hover:from-gray-500 hover:to-gray-600 text-white rounded-full font-semibold text-xs transition-all duration-300 transform hover:scale-105 shadow-lg">
                                پاک کردن
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Results Info -->
        <div class="flex items-center justify-between mb-6">
            <div class="flex items-center gap-4">
                <span id="results-count" class="text-gray-600">نمایش {{ total_products }} محصول</span>
                <div id="active-filters" class="flex gap-2">
                    {% if current_category %}
                    <span class="bg-purple-100 text-purple-600 px-2 py-1 rounded-full text-xs">{{ current_category }}</span>
                    {% endif %}
                    {% if current_brand %}
                    <span class="bg-blue-100 text-blue-600 px-2 py-1 rounded-full text-xs">{{ current_brand }}</span>
                    {% endif %}
                    {% if search_query %}
                    <span class="bg-green-100 text-green-600 px-2 py-1 rounded-full text-xs">{{ search_query }}</span>
                    {% endif %}
                </div>
            </div>
            <div class="flex items-center gap-2">
                <button onclick="toggleView('grid')" id="grid-view" class="p-2 bg-purple-600 text-white rounded-lg">
                    <i class="fas fa-th"></i>
                </button>
                <button onclick="toggleView('list')" id="list-view" class="p-2 bg-gray-200 text-gray-600 rounded-lg hover:bg-gray-300 transition-colors">
                    <i class="fas fa-list"></i>
                </button>
            </div>
        </div>
        
        <!-- Products Grid -->
        <div id="products-grid" class="products-grid">
            <!-- Products will be loaded here by JavaScript -->
        </div>
        
        <!-- No Results Message -->
        <div id="no-results" class="text-center py-12 hidden">
            <i class="fas fa-search text-6xl text-gray-300 mb-4"></i>
            <h3 class="text-xl font-semibold text-gray-600 mb-2">هیچ محصولی یافت نشد</h3>
            <p class="text-gray-500">لطفاً فیلترهای خود را تغییر دهید یا عبارت جستجوی دیگری را امتحان کنید.</p>
        </div>
        
        <!-- Load More Button -->
        <div id="load-more-container" class="text-center py-8">
            <button id="load-more-btn" onclick="loadMoreProducts()" class="bg-purple-600 hover:bg-purple-700 text-white px-8 py-3 rounded-xl font-semibold transition-colors flex items-center justify-center mx-auto">
                <i class="fas fa-plus ml-2"></i>
                نمایش بیشتر
            </button>
        </div>
        
        <!-- Loading Indicator -->
        <div id="loading-indicator" class="hidden flex justify-center items-center py-8">
            <div class="flex items-center space-x-2 space-x-reverse">
                <div class="animate-spin rounded-full h-6 w-6 border-b-2 border-purple-600"></div>
                <span class="text-gray-600 dark:text-gray-400">در حال بارگذاری محصولات بیشتر...</span>
            </div>
        </div>
        
        <!-- End of Products Message -->
        <div id="end-message" class="hidden text-center py-8">
            <div class="text-gray-500 dark:text-gray-400">
                <i class="fas fa-check-circle text-2xl mb-2"></i>
                <p>تمام محصولات نمایش داده شدند</p>
            </div>
        </div>
    </div>
</div>

<script>
// Filter functionality
function toggleCompact() {
    const panel = document.getElementById('filter-panel');
    panel.classList.toggle('translate-x-full');
}

function setCategoryFilter(category) {
    // Remove active class from all category pills
    document.querySelectorAll('.category-pill').forEach(pill => {
        pill.classList.remove('active');
        pill.classList.remove('bg-gradient-to-r', 'from-gray-200', 'to-gray-300', 'text-gray-700');
        pill.classList.add('bg-gradient-to-r', 'from-red-200', 'to-pink-200', 'text-red-700');
    });
    
    // Add active class to clicked pill
    event.target.classList.add('active');
    event.target.classList.remove('bg-gradient-to-r', 'from-red-200', 'to-pink-200', 'text-red-700');
    event.target.classList.add('bg-gradient-to-r', 'from-gray-200', 'to-gray-300', 'text-gray-700');
    
    // Update filter
    activeFilters.category = category;
    filterProducts();
}

function setBrandFilter(brand) {
    // Remove active class from all brand pills
    document.querySelectorAll('.brand-pill').forEach(pill => {
        pill.classList.remove('active');
        pill.classList.remove('bg-gradient-to-r', 'from-gray-200', 'to-gray-300', 'text-gray-700');
        pill.classList.add('bg-gradient-to-r', 'from-blue-200', 'to-indigo-200', 'text-blue-700');
    });
    
    // Add active class to clicked pill
    event.target.classList.add('active');
    event.target.classList.remove('bg-gradient-to-r', 'from-blue-200', 'to-indigo-200', 'text-blue-700');
    event.target.classList.add('bg-gradient-to-r', 'from-gray-200', 'to-gray-300', 'text-gray-700');
    
    // Update filter
    activeFilters.brand = brand;
    filterProducts();
}

function quickFilter(filter) {
    // Toggle filter
    if (activeFilters.quickFilter === filter) {
        activeFilters.quickFilter = null;
    } else {
        activeFilters.quickFilter = filter;
    }
    
    // Update button states
    document.querySelectorAll('.quick-filter-btn').forEach(btn => {
        btn.classList.remove('active');
    });
    
    // Add active class to clicked button
    const clickedBtn = event.target.closest('.quick-filter-btn');
    if (clickedBtn && activeFilters.quickFilter === filter) {
        clickedBtn.classList.add('active');
    }
    
    filterProducts();
}

function applyFilters() {
    const search = document.getElementById('search-input').value;
    const minPrice = document.getElementById('min-price').value;
    const maxPrice = document.getElementById('max-price').value;
    const sort = document.getElementById('sort-filter').value;
    
    // Convert formatted prices to numbers
    const minPriceNum = minPrice ? parseInt(minPrice.replace(/,/g, '')) : null;
    const maxPriceNum = maxPrice ? parseInt(maxPrice.replace(/,/g, '')) : null;
    
    console.log('Applying filters:', { search, minPrice: minPriceNum, maxPrice: maxPriceNum, sort });
    
    // Update activeFilters
    activeFilters.search = search.toLowerCase();
    activeFilters.minPrice = minPriceNum;
    activeFilters.maxPrice = maxPriceNum;
    activeFilters.sort = sort;
    
    filterProducts();
}

function formatPriceInput(input) {
    // Remove all non-digit characters
    let value = input.value.replace(/[^\d]/g, '');
    
    // Add thousands separators
    if (value.length > 0) {
        value = value.replace(/\B(?=(\d{3})+(?!\d))/g, ',');
    }
    
    // Update input value
    input.value = value;
}

// Add event listeners for price range
document.addEventListener('DOMContentLoaded', function() {
    const minPriceInput = document.getElementById('min-price');
    const maxPriceInput = document.getElementById('max-price');
    const applyBtn = document.querySelector('button[onclick="applyFilters()"]');
    const clearBtn = document.querySelector('button[onclick="clearFilters()"]');
    
    if (minPriceInput) {
        minPriceInput.addEventListener('input', formatPriceInput);
    }
    
    if (maxPriceInput) {
        maxPriceInput.addEventListener('input', formatPriceInput);
    }
    
    if (applyBtn) {
        applyBtn.addEventListener('click', function(e) {
            e.preventDefault();
            applyFilters();
        });
    }
    
    if (clearBtn) {
        clearBtn.addEventListener('click', function(e) {
            e.preventDefault();
            clearFilters();
        });
    }
});

function clearFilters() {
    console.log('Clearing all filters');
    
    // Reset all form elements
    document.getElementById('search-input').value = '';
    document.getElementById('min-price').value = '';
    document.getElementById('max-price').value = '';
    document.getElementById('sort-filter').value = 'default';
    document.getElementById('category-filter').value = '';
    document.getElementById('brand-filter').value = '';
    
    // Reset all filters
    activeFilters = {
        search: '',
        category: '',
        brand: '',
        sort: 'default',
        minPrice: null,
        maxPrice: null,
        quickFilter: null
    };
    
    // Reset all pills and buttons
    document.querySelectorAll('.category-pill, .brand-pill, .quick-filter-btn').forEach(element => {
        element.classList.remove('active');
    });
    
    // Set first pills as active
    const firstCategoryPill = document.querySelector('.category-pill');
    const firstBrandPill = document.querySelector('.brand-pill');
    
    if (firstCategoryPill) firstCategoryPill.classList.add('active');
    if (firstBrandPill) firstBrandPill.classList.add('active');
    
    console.log('Filters cleared, calling filterProducts');
    filterProducts();
}

function toggleView(view) {
    const gridView = document.getElementById('grid-view');
    const listView = document.getElementById('list-view');
    const productsGrid = document.getElementById('products-grid');
    
    if (view === 'grid') {
        gridView.classList.add('bg-purple-600', 'text-white');
        gridView.classList.remove('bg-gray-200', 'text-gray-600');
        listView.classList.add('bg-gray-200', 'text-gray-600');
        listView.classList.remove('bg-purple-600', 'text-white');
        productsGrid.classList.remove('grid-cols-1');
        productsGrid.classList.add('grid-cols-2', 'sm:grid-cols-3', 'lg:grid-cols-4');
    } else {
        listView.classList.add('bg-purple-600', 'text-white');
        listView.classList.remove('bg-gray-200', 'text-gray-600');
        gridView.classList.add('bg-gray-200', 'text-gray-600');
        gridView.classList.remove('bg-purple-600', 'text-white');
        productsGrid.classList.remove('grid-cols-2', 'sm:grid-cols-3', 'lg:grid-cols-4');
        productsGrid.classList.add('grid-cols-1');
    }
}

function openProductModal(productId) {
    window.location.href = `/shop/product/${productId}/`;
}

function addToCart(productId) {
    // TODO: Implement cart functionality
    console.log('Adding product to cart:', productId);
}
</script>
{% endblock %} 